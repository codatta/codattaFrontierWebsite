<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CEX Withdrawal Hot Wallet Collection</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      height: 100%;
      overflow: auto;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: radial-gradient(ellipse at top, #1a0a2e 0%, #0a0a0a 50%);
      background-attachment: fixed;
      color: #ffffff;
    }

    body {
      padding: 16px 32px;
      min-height: 100vh;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        radial-gradient(circle at 20% 30%, rgba(139, 92, 246, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 70%, rgba(59, 130, 246, 0.1) 0%, transparent 50%);
      pointer-events: none;
      z-index: 0;
    }

    .app-root {
      max-width: 1200px;
      margin: 0 auto;
      position: relative;
      z-index: 1;
      padding: 0 16px;
    }

    .app-header {
      margin-bottom: 20px;
      text-align: center;
    }

    .title-main {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 20px;
      background: linear-gradient(135deg, #ffffff 0%, #a78bfa 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: -0.5px;
    }

    .title-sub {
      font-size: 15px;
      color: #a0a0a0;
    }

    .guidelines-section {
      margin-top: 16px;
      margin-bottom: 20px;
      text-align: left;
    }

    .guidelines-title {
      font-size: 15px;
      font-weight: 700;
      color: #ffffff;
      margin-bottom: 10px;
      margin-top: 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .guidelines-title::before {
      content: '';
      width: 3px;
      height: 14px;
      background: linear-gradient(135deg, #6366f1, #22c1c3);
      border-radius: 999px;
    }

    .guidelines-subsection {
      margin-bottom: 12px;
    }

    .guidelines-subsection:last-child {
      margin-bottom: 0;
    }

    .guidelines-subtitle {
      font-size: 12px;
      font-weight: 700;
      color: #ffffff;
      margin-bottom: 10px;
    }

    .guidelines-text {
      font-size: 13px;
      line-height: 1.6;
      color: #d0d0d0;
    }

    .guidelines-subsection .requirements-list {
      margin-top: 8px;
    }

    .guidelines-subsection .requirements-list li {
      color: #d1d5db;
      font-size: 13px;
    }

    .step-container {
      background: linear-gradient(135deg, #1a1a1a 0%, #1f1f1f 100%);
      border-radius: 12px;
      padding: 18px;
      margin-bottom: 16px;
      border: 1px solid rgba(139, 92, 246, 0.2);
      backdrop-filter: blur(10px);
      position: relative;
      display: grid;
      grid-template-columns: 280px 1fr;
      gap: 18px;
      align-items: flex-start;
    }

    .step-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #8b5cf6, #667eea, #8b5cf6);
      background-size: 200% 100%;
      animation: shimmer 3s linear infinite;
      border-radius: 16px 16px 0 0;
    }

    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }

    .step-left {
      position: sticky;
      top: 24px;
      height: fit-content;
    }

    .step-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 12px;
    }

    .step-number {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: linear-gradient(135deg, #8b5cf6, #667eea);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 15px;
      flex-shrink: 0;
      box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
    }

    .step-title {
      font-size: 16px;
      font-weight: 700;
      color: #ffffff;
    }

    .step-reminder {
      background: rgba(59, 130, 246, 0.1);
      border-left: 4px solid #3b82f6;
      border-radius: 6px;
      padding: 10px 12px;
      font-size: 12px;
      line-height: 1.4;
      color: #e5e7eb;
      margin-bottom: 0;
    }

    .step-reminder.warning {
      background: rgba(245, 158, 11, 0.1);
      border-left-color: #f59e0b;
    }

    .step-right {
      min-width: 0;
      padding-left: 0;
    }

    .step-guide {
      font-size: 13px;
      line-height: 1.5;
      color: #ffffff;
      margin-bottom: 12px;
    }

    .exchange-link-container {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 10px; /* add a bit more space between label and link */
      animation: fadeIn 0.3s ease-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-4px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Official website pill in Step 1 â€“ match explorer-link style in Step 4 */
    .exchange-link-single {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      background: rgba(56, 189, 248, 0.12);
      border: 1px solid rgba(56, 189, 248, 0.4);
      border-radius: 8px;
      text-decoration: none;
      color: #7dd3fc;
      font-size: 13px;
      font-weight: 600;
      transition: all 0.2s ease-out;
      width: 100%;
      justify-content: flex-start;
    }

    .exchange-link-single:hover {
      background: rgba(56, 189, 248, 0.2);
      border-color: rgba(56, 189, 248, 0.6);
      color: #e0f2fe;
      transform: translateX(4px);
      box-shadow: 0 2px 8px rgba(56, 189, 248, 0.3);
    }

    .explorer-link {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      background: rgba(56, 189, 248, 0.12);
      border: 1px solid rgba(56, 189, 248, 0.4);
      border-radius: 8px;
      text-decoration: none;
      color: #7dd3fc;
      font-size: 13px;
      font-weight: 600;
      transition: all 0.2s ease-out;
      width: 100%;
      justify-content: flex-start;
    }

    .explorer-link:hover {
      background: rgba(56, 189, 248, 0.2);
      border-color: rgba(56, 189, 248, 0.6);
      color: #e0f2fe;
      transform: translateX(4px);
      box-shadow: 0 2px 8px rgba(56, 189, 248, 0.3);
    }

    .explorer-link.disabled {
      opacity: 0.7;
      cursor: default;
      pointer-events: none;
    }

    .field-select,
    .field input,
    .field select,
    .field input[type="date"],
    .field-group input,
    .field-group select,
    .field-group input[type="date"] {
      width: 100%;
      border-radius: 8px;
      border: 1px solid rgba(139, 92, 246, 0.3);
      padding: 10px 12px;
      font-size: 13px;
      background: rgba(0, 0, 0, 0.4);
      color: #ffffff;
      outline: none;
      transition: all 0.2s ease-out;
      font-family: inherit;
    }

    .field-select:focus,
    .field input:focus,
    .field select:focus,
    .field input[type="date"]:focus,
    .field-group input:focus,
    .field-group select:focus,
    .field-group input[type="date"]:focus {
      border-color: #8b5cf6;
      box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2);
    }

    .requirements-list {
      list-style: none;
      padding-left: 0;
      margin: 8px 0;
    }

    .requirements-list li {
      padding: 4px 0;
      padding-left: 24px;
      position: relative;
      color: #d1d5db;
    }

    .requirements-list li::before {
      content: 'âœ“';
      position: absolute;
      left: 0;
      color: #10b981;
      font-weight: 700;
    }

    .network-currency-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 8px;
      margin: 8px 0;
      padding: 10px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      font-size: 13px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    .network-currency-item {
      color: #a78bfa;
    }

    /* Form Fields */
    .form-section {
      margin-top: 0;
    }

    .form-section-title {
      font-size: 14px;
      font-weight: 700;
      color: #ffffff;
      margin-bottom: 18px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .form-section-title::before {
      content: '';
      width: 3px;
      height: 16px;
      background: linear-gradient(135deg, #8b5cf6, #667eea);
      border-radius: 2px;
    }

    .field-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 12px;
      position: relative;
      padding-bottom: 12px;
    }

    .field-label {
      font-size: 13px;
      font-weight: 600;
      color: #d0d0d0;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .field-label span.required {
      color: #ef4444;
      font-size: 13px;
    }

    .field-hint {
      font-size: 11px;
      color: #888888;
      margin-top: 2px;
    }

    .field-date-wrapper {
      position: relative;
    }

    .field-date-wrapper input[type="date"].show-placeholder {
      color: transparent;
      caret-color: transparent;
    }

    .date-display-placeholder {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 13px;
      color: #666666;
      pointer-events: none;
    }

    .field input::placeholder,
    .field-group input::placeholder {
      color: #666666;
    }

    .field input[type="date"]::-webkit-calendar-picker-indicator {
      filter: invert(1);
      cursor: pointer;
    }

    .field-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      column-gap: 22px;
      row-gap: 0; /* vertical spacing handled by .field-group margin-bottom for consistency */
    }

    /* Optimized form layout for Step 3 */
    .form-section .field-group:not(:last-child) {
      margin-bottom: 12px;
    }

    /* File Upload Area - Left/Right Layout */
    .file-upload-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-top: 12px;
    }

    .example-image-section {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .example-image-label {
      font-size: 13px;
      color: #a78bfa;
      font-weight: 600;
    }

    .example-image {
      width: 100%;
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid rgba(139, 92, 246, 0.3);
      background: rgba(0, 0, 0, 0.3);
      cursor: pointer;
      transition: all 0.2s ease-out;
    }

    .example-image:hover {
      border-color: rgba(139, 92, 246, 0.5);
      transform: scale(1.01);
    }

    .example-image img {
      width: 100%;
      height: auto;
      display: block;
      max-height: 400px;
      object-fit: contain;
    }

    /* File Input */
    .file-input-wrapper {
      position: relative;
      width: 100%;
      min-height: 200px;
      border-radius: 8px;
      border: 2px dashed rgba(139, 92, 246, 0.3);
      background: rgba(0, 0, 0, 0.3);
      padding: 20px;
      transition: all 0.3s ease-out;
      overflow: hidden;
    }

    .file-input-wrapper:hover {
      border-color: rgba(139, 92, 246, 0.5);
      background: rgba(0, 0, 0, 0.4);
    }

    .file-input-wrapper.has-image {
      border-style: solid;
      border-color: rgba(139, 92, 246, 0.5);
      padding: 12px;
      min-height: auto;
    }

    .field input[type="file"] {
      display: none !important;
    }

    .file-input-display {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 12px;
      width: 100%;
      height: 100%;
      min-height: 160px;
      z-index: 10;
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      cursor: pointer;
      margin: 0;
      padding: 20px;
      box-sizing: border-box;
      background: transparent;
    }

    .file-input-wrapper.has-image .file-input-display {
      display: none;
    }

    .file-input-button {
      padding: 10px 20px;
      border-radius: 8px;
      background: linear-gradient(135deg, #8b5cf6, #667eea);
      border: 1px solid rgba(139, 92, 246, 0.5);
      font-size: 14px;
      font-weight: 600;
      color: #ffffff;
      white-space: nowrap;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: all 0.2s ease-out;
      box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
      pointer-events: none;
    }

    .file-input-button::before {
      content: 'ðŸ“·';
      font-size: 16px;
    }

    .file-input-button:hover {
      background: linear-gradient(135deg, #9d6aff, #7c7ff5);
      box-shadow: 0 6px 16px rgba(139, 92, 246, 0.4);
      transform: translateY(-1px);
    }

    .file-input-name {
      font-size: 13px;
      color: #9ca3af;
      text-align: center;
      pointer-events: none;
    }

    .image-preview {
      display: none;
      width: 100%;
      max-width: 100%;
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid rgba(139, 92, 246, 0.3);
      background: rgba(0, 0, 0, 0.5);
      cursor: pointer;
      transition: all 0.2s ease-out;
    }

    .file-input-wrapper.has-image .image-preview {
      display: block;
    }

    .image-preview-container {
      position: relative;
      width: 100%;
    }

    .image-preview img {
      width: 100%;
      height: auto;
      display: block;
      max-height: 400px;
      object-fit: contain;
    }

    .image-preview:hover {
      border-color: rgba(139, 92, 246, 0.6);
      transform: scale(1.02);
    }

    .image-preview img {
      width: 100%;
      height: auto;
      display: block;
      max-height: 400px;
      object-fit: contain;
    }

    .image-preview-container {
      position: relative;
      width: 100%;
    }

    .image-preview-close {
      position: absolute;
      top: 8px;
      right: 8px;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: rgba(0, 0, 0, 0.7);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: #ffffff;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 16px;
      z-index: 3;
      transition: all 0.2s ease-out;
    }

    .image-preview-close:hover {
      background: rgba(239, 68, 68, 0.9);
      border-color: rgba(239, 68, 68, 1);
    }

    .image-preview-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.9);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .image-preview-modal.active {
      display: flex;
    }

    .image-preview-modal img {
      max-width: 90%;
      max-height: 90%;
      border-radius: 8px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
    }

    .image-preview-modal-close {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: #ffffff;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 24px;
      transition: all 0.2s ease-out;
    }

    .image-preview-modal-close:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .evidence-pill {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 10px;
      font-weight: 700;
      letter-spacing: 0.09em;
      text-transform: uppercase;
      background: radial-gradient(circle at 0% 0%, rgba(251, 191, 36, 0.25), transparent 55%),
                  rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(251, 191, 36, 0.9);
      color: #facc15;
      margin-left: 6px;
    }

    .evidence-pill-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #facc15;
      box-shadow: 0 0 0 3px rgba(250, 204, 21, 0.4);
    }

    .field.error input,
    .field.error select {
      border-color: #ef4444;
      box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.2);
    }

    .error-text {
      font-size: 11px;
      color: #ef4444;
      position: absolute;
      left: 0;
      bottom: 0;
    }

    /* Submit Bar */
    .submit-bar {
      margin: 20px auto 0;
      padding: 16px 0 8px;
      display: flex;
      justify-content: center;
      align-items: center;
      border-top: 1px solid rgba(31, 41, 55, 0.9);
      max-width: 600px;
    }

    .submit-btn {
      padding: 14px 32px;
      border-radius: 12px;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-size: 15px;
      font-weight: 700;
      color: #ffffff;
      background: linear-gradient(135deg, #8b5cf6, #667eea);
      box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4);
      transition: all 0.2s ease-out;
    }

    .submit-btn:hover:not(.disabled) {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(139, 92, 246, 0.5);
    }

    .submit-btn:active:not(.disabled) {
      transform: translateY(0);
    }

    .submit-btn.disabled {
      opacity: 0.5;
      cursor: not-allowed;
      box-shadow: none;
    }

    @media (max-width: 768px) {
      body {
        padding: 16px;
      }

      .app-root {
        padding: 0 12px;
      }

      .field-grid {
        grid-template-columns: 1fr;
      }

      .network-currency-grid {
        grid-template-columns: 1fr;
      }

      .step-container {
        grid-template-columns: 1fr;
        gap: 20px;
      }

      .step-left {
        position: static;
      }

      .file-upload-container {
        grid-template-columns: 1fr;
        gap: 16px;
      }
    }
  </style>
</head>
<body>
  <div class="app-root">
    <header class="app-header">
      <div class="title-main">CEX Withdrawal Hot Wallet Collection</div>
      <div class="guidelines-section">
        <div class="guidelines-title">Guidelines</div>
        
        <div class="guidelines-subsection">
          <div class="guidelines-subtitle">Task Description</div>
          <div class="guidelines-text">
            This task aims to collect withdrawal transaction records from centralized exchanges (CEX) and identify the hot wallet addresses used by these exchanges. By tracking withdrawal transactions and analyzing fund flows from exchange hot wallets to user addresses, we can map the withdrawal routing patterns of major exchanges. Please follow the steps below to submit your withdrawal record: first, confirm and select the exchange where you made the withdrawal; then navigate to the withdrawal history page; select a valid withdrawal record that meets the requirements; verify the transaction details on the blockchain explorer; and finally, submit all relevant transaction information. Accurate and complete submissions help build a high-quality database of exchange hot wallet addresses.
          </div>
        </div>

        <div class="guidelines-subsection">
          <div class="guidelines-subtitle">Requirements (Must Read)</div>
          <ul class="requirements-list">
            <li>Use PC desktop browser only</li>
            <li>Mobile apps/browsers not supported</li>
          </ul>
        </div>
      </div>
    </header>

    <!-- Step 1 -->
    <div class="step-container">
      <div class="step-left">
        <div class="step-header">
          <div class="step-number">1</div>
          <div class="step-title">Confirm Exchange</div>
        </div>
      </div>
      <div class="step-right">
        <div class="step-guide">
          Select the exchange where you have withdrawal records. Ensure withdrawals are enabled for required networks and tokens.
        </div>
        <div class="field-group" style="margin-top: 12px; margin-bottom: 12px; padding-bottom: 0;">
          <label class="field-label">
            Exchange Name
            <span class="required">*</span>
          </label>
          <select id="exchangeName" class="field-select">
            <option value="">Select exchange</option>
            <option value="Binance">Binance</option>
            <option value="Bybit">Bybit</option>
            <option value="OKX">OKX</option>
            <option value="Coinbase">Coinbase</option>
            <option value="Kraken">Kraken</option>
            <option value="Huobi">Huobi</option>
            <option value="Gate.io">Gate.io</option>
            <option value="KuCoin">KuCoin</option>
            <option value="Bitfinex">Bitfinex</option>
            <option value="Bitget">Bitget</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Step 2 -->
    <div class="step-container">
      <div class="step-left">
        <div class="step-header">
          <div class="step-number">2</div>
          <div class="step-title">Navigate to Withdrawal History Page</div>
        </div>
      </div>
      <div class="step-right">
        <div class="step-guide">
          Navigate to the withdrawal history page on your exchange.
        </div>
        <div class="field-group" id="exchangeLinkContainer" style="margin-top: 12px; margin-bottom: 12px; padding-bottom: 0;">
          <label class="field-label">
            Official website
          </label>
          <a id="exchangeLink" href="#" target="_blank" rel="noopener noreferrer" class="explorer-link disabled">
            <span id="exchangeLinkText">(Select an exchange to view)</span>
          </a>
        </div>
        <div class="field-group" id="withdrawHistoryLinkContainer" style="margin-top: 0; margin-bottom: 0; padding-bottom: 0;">
          <label class="field-label">
            Withdrawal history URL
          </label>
          <a id="withdrawHistoryLink" href="#" target="_blank" rel="noopener noreferrer" class="explorer-link disabled">
            <span id="withdrawHistoryLinkText">(Navigate manually on the exchange website)</span>
          </a>
        </div>
        <div class="field-hint" style="margin-top: 8px; color: #a0a0a0; font-size: 12px;">
          Note: Links are auto-generated for reference only. If invalid, navigate manually on the exchange website.
        </div>
      </div>
    </div>

    <!-- Step 3 -->
    <div class="step-container">
      <div class="step-left">
        <div class="step-header">
          <div class="step-number">3</div>
          <div class="step-title">Select Your Withdrawal Record</div>
        </div>
        <div class="step-reminder warning">
          <strong>Requirements:</strong>
          <ul class="requirements-list">
            <li>Within last 30 days</li>
            <li>Supported Network/Token (see below)</li>
          </ul>
          <div style="margin-top: 6px; font-size: 12px; font-weight: 600; color: #facc15;">Supported Combinations:</div>
          <div class="network-currency-grid">
            <div class="network-currency-item">BTC (BTC)</div>
            <div class="network-currency-item">ETH (ETH/USDC/USDT/BNB/stETH)</div>
            <div class="network-currency-item">TRON (TRX/USDT)</div>
            <div class="network-currency-item">SOL (SOL)</div>
            <div class="network-currency-item">BNB (BNB/ETH/USDC/USDT/XRP)</div>
            <div class="network-currency-item">ARB (ETH)</div>
            <div class="network-currency-item">OP (ETH)</div>
            <div class="network-currency-item">BASE (ETH)</div>
            <div class="network-currency-item">Polygon (POL)</div>
            <div class="network-currency-item">ETC (ETC)</div>
            <div class="network-currency-item">BCH (BCH)</div>
          </div>
        </div>
      </div>
      <div class="step-right">
        <div class="form-section">
        <div class="field-group">
          <label class="field-label">
            Exchange UI Screenshot
            <span class="required">*</span>
            <span class="evidence-pill"><span class="evidence-pill-dot"></span>Key evidence</span>
          </label>
          <div class="file-upload-container">
            <div class="example-image-section">
              <div class="example-image-label">Example Screenshot:</div>
              <div class="example-image" onclick="showImageModal('images/withdraw1.png')">
                <img src="images/withdraw1.png" alt="Example withdrawal screenshot" />
              </div>
            </div>
            <div class="file-input-wrapper" id="exchangeScreenshotWrapper">
              <input id="exchangeScreenshot" type="file" accept="image/*" style="display: none;" />
              <div class="file-input-display" onclick="document.getElementById('exchangeScreenshot').click();">
                <span class="file-input-button">Upload screenshot</span>
                <span class="file-input-name" data-placeholder="No image selected">No image selected</span>
              </div>
              <div class="image-preview-container">
                <div class="image-preview" id="exchangeScreenshotPreview">
                  <div class="image-preview-close" onclick="clearImagePreview('exchangeScreenshot')">Ã—</div>
                  <img id="exchangeScreenshotImg" src="" alt="Preview" />
                </div>
              </div>
            </div>
          </div>
          <div class="field-hint">
            Full-page screenshot including: URL, exchange logo, withdrawal address, token, amount, date/time, and TxHash.
          </div>
        </div>

        <div class="field-grid">
          <div class="field-group">
            <label class="field-label">
              Network
              <span class="required">*</span>
            </label>
            <select id="withdrawNetwork">
              <option value="">Select network</option>
              <option value="BTC">BTC</option>
              <option value="ETH">ETH</option>
              <option value="TRON">TRON</option>
              <option value="SOL">SOL</option>
              <option value="BNB">BNB</option>
              <option value="ARB">ARB</option>
              <option value="OP">OP</option>
              <option value="BASE">BASE</option>
              <option value="Polygon">Polygon</option>
              <option value="ETC">ETC</option>
              <option value="BCH">BCH</option>
            </select>
          </div>

          <div class="field-group">
            <label class="field-label">
              Coin
              <span class="required">*</span>
            </label>
            <select id="withdrawCoin">
              <option value="">Select coin</option>
            </select>
          </div>

          <div class="field-group">
            <label class="field-label">
              Withdraw Amount
              <span class="required">*</span>
            </label>
            <input id="withdrawAmount" type="text" placeholder="Exact withdrawal amount from the record" />
          </div>

          <div class="field-group">
            <label class="field-label">
              Network Fee
              <span class="required">*</span>
            </label>
            <input id="withdrawNetworkFee" type="text" placeholder="Network fee / withdrawal fee from the record" />
          </div>
        </div>

        <div class="field-group">
          <label class="field-label">
            Your Withdrawal Wallet Address
            <span class="required">*</span>
          </label>
          <input id="withdrawalAddress" type="text" placeholder="Your wallet address that received the withdrawal" />
        </div>

        <div class="field-group">
          <label class="field-label">
            Transaction Hash (TxHash)
            <span class="required">*</span>
          </label>
          <input id="withdrawalTxHash" type="text" placeholder="Transaction hash from the exchange" />
        </div>

        <div class="field-group">
          <label class="field-label">
            Transaction Date
            <span class="required">*</span>
          </label>
          <div class="field-date-wrapper">
            <input id="transactionDate" type="date" lang="en-CA" class="show-placeholder" />
            <span class="date-display-placeholder" id="transactionDatePlaceholder">YYYY-MM-DD</span>
          </div>
          <div class="field-hint">Select the date when the withdrawal occurred (within the last 30 days)</div>
        </div>
        </div>
      </div>
    </div>

    <!-- Step 4 -->
    <div class="step-container">
      <div class="step-left">
        <div class="step-header">
          <div class="step-number">4</div>
          <div class="step-title">Find Transaction on Blockchain Explorer</div>
        </div>
      </div>
      <div class="step-right">
        <div class="form-section">
        <div class="field-group" id="explorerLinkField">
          <label class="field-label">
            Open this transaction on block explorer
          </label>
          <a id="explorerLink" class="explorer-link disabled">
            <span id="explorerLinkText">(Fill Network and Transaction Hash in Step 3 to view)</span>
          </a>
          <div class="field-hint">
            Auto-generated from Step 3. If unavailable, search manually by TxHash.
          </div>
        </div>

        <div class="field-group">
          <label class="field-label">
            Blockchain Explorer Screenshot
            <span class="required">*</span>
            <span class="evidence-pill"><span class="evidence-pill-dot"></span>Key evidence</span>
          </label>
          <div class="file-upload-container">
            <div class="example-image-section">
              <div class="example-image-label">Example Screenshot:</div>
              <div class="example-image" onclick="showImageModal('images/withdraw2.png')">
                <img src="images/withdraw2.png" alt="Example explorer transaction screenshot" />
              </div>
            </div>
            <div class="file-input-wrapper" id="explorerScreenshotWrapper">
              <input id="explorerScreenshot" type="file" accept="image/*" style="display: none;" />
              <div class="file-input-display" onclick="document.getElementById('explorerScreenshot').click();">
                <span class="file-input-button">Upload screenshot</span>
                <span class="file-input-name" data-placeholder="No image selected">No image selected</span>
              </div>
              <div class="image-preview-container">
                <div class="image-preview" id="explorerScreenshotPreview">
                  <div class="image-preview-close" onclick="clearImagePreview('explorerScreenshot')">Ã—</div>
                  <img id="explorerScreenshotImg" src="" alt="Preview" />
                </div>
              </div>
            </div>
          </div>
          <div class="field-hint">
            Full-page screenshot including: URL, TxHash, From address, and To address.
          </div>
        </div>

        <div class="field-group">
          <label class="field-label">
            Sender Address (From)
            <span class="required">*</span>
          </label>
          <input id="senderAddress" type="text" placeholder="Hot wallet address that sent the funds" />
          <div class="field-hint">This is the hot wallet address controlled by the exchange</div>
        </div>

        <div class="field-group">
          <label class="field-label">
            Receiver Address (To)
            <span class="required">*</span>
          </label>
          <input id="receiverAddress" type="text" placeholder="Your wallet address that received the funds" />
        </div>
        </div>
      </div>
    </div>

    <!-- Submit Bar -->
    <footer class="submit-bar">
      <button class="submit-btn disabled" type="button" id="submitBtn">
        Submit Withdrawal Task
      </button>
    </footer>
  </div>

  <script>
    // Exchange name to URL mapping
    const exchangeUrls = {
      'Binance': 'https://www.binance.com',
      'Bybit': 'https://www.bybit.com',
      'OKX': 'https://www.okx.com',
      'Coinbase': 'https://www.coinbase.com',
      'Kraken': 'https://www.kraken.com',
      'Huobi': 'https://www.huobi.com',
      'Gate.io': 'https://www.gate.io',
      'KuCoin': 'https://www.kucoin.com',
      'Bitfinex': 'https://www.bitfinex.com',
      'Bitget': 'https://www.bitget.com'
    };

    // Exchange name to withdrawal history URL mapping
    const withdrawalHistoryUrls = {
      'Binance': 'https://www.binance.com/en/my/wallet/account/main/withdrawal/crypto',
      'Bybit': 'https://www.bybit.com/user/assets/withdrawal',
      'OKX': 'https://www.okx.com/balance/withdrawal',
      'Coinbase': 'https://www.coinbase.com/accounts',
      'Kraken': 'https://www.kraken.com/funding',
      'Huobi': 'https://www.huobi.com/en-us/asset/withdraw',
      'Gate.io': 'https://www.gate.io/myaccount/withdraw',
      'KuCoin': 'https://www.kucoin.com/assets/withdraw',
      'Bitfinex': 'https://www.bitfinex.com/withdraw',
      'Bitget': 'https://www.bitget.com/en/spot/withdraw'
    };

    // Network to block explorer TX URL template
    const explorerUrls = {
      'BTC': 'https://www.blockchain.com/explorer/transactions/btc/{tx}',
      'ETH': 'https://etherscan.io/tx/{tx}',
      'TRON': 'https://tronscan.org/#/transaction/{tx}',
      'SOL': 'https://explorer.solana.com/tx/{tx}',
      'BNB': 'https://bscscan.com/tx/{tx}',
      'ARB': 'https://arbiscan.io/tx/{tx}',
      'OP': 'https://optimistic.etherscan.io/tx/{tx}',
      'BASE': 'https://basescan.org/tx/{tx}',
      'Polygon': 'https://polygonscan.com/tx/{tx}',
      'ETC': 'https://etcblockexplorer.com/tx/{tx}',
      'BCH': 'https://www.blockchain.com/explorer/transactions/bch/{tx}'
    };

    // Network â†’ allowed coins mapping (from left-side requirements)
    const networkCoinOptions = {
      'BTC': ['BTC'],
      'ETH': ['ETH', 'USDC', 'USDT', 'BNB', 'stETH'],
      'TRON': ['TRX', 'USDT'],
      'SOL': ['SOL'],
      'BNB': ['BNB', 'ETH', 'USDC', 'BSC-USDT', 'XRP'],
      'ARB': ['ETH'],
      'OP': ['ETH'],
      'BASE': ['ETH'],
      'Polygon': ['POL'],
      'ETC': ['ETC'],
      'BCH': ['BCH']
    };

    const requiredFields = [
      'exchangeName',
      'exchangeScreenshot',
      'withdrawNetwork',
      'withdrawCoin',
      'withdrawAmount',
      'withdrawNetworkFee',
      'withdrawalAddress',
      'withdrawalTxHash',
      'transactionDate',
      'explorerScreenshot',
      'senderAddress',
      'receiverAddress'
    ];

    const submitBtn = document.getElementById('submitBtn');
    const transactionDateInput = document.getElementById('transactionDate');
    const exchangeNameSelect = document.getElementById('exchangeName');
    const exchangeLinkContainer = document.getElementById('exchangeLinkContainer');
    const exchangeLink = document.getElementById('exchangeLink');
    const exchangeLinkText = document.getElementById('exchangeLinkText');
    const withdrawHistoryLinkContainer = document.getElementById('withdrawHistoryLinkContainer');
    const withdrawHistoryLink = document.getElementById('withdrawHistoryLink');
    const withdrawHistoryLinkText = document.getElementById('withdrawHistoryLinkText');
    const withdrawNetworkSelect = document.getElementById('withdrawNetwork');
    const withdrawCoinSelect = document.getElementById('withdrawCoin');
    const withdrawalTxHashInput = document.getElementById('withdrawalTxHash');
    const explorerLinkField = document.getElementById('explorerLinkField');
    const explorerLinkEl = document.getElementById('explorerLink');
    const explorerLinkTextEl = document.getElementById('explorerLinkText');

    // Handle exchange selection change
    function updateExchangeLink() {
      const selectedExchange = exchangeNameSelect.value;
      if (selectedExchange && exchangeUrls[selectedExchange]) {
        const url = exchangeUrls[selectedExchange];
        const domain = url.replace('https://www.', '').replace('https://', '');
        exchangeLink.href = url;
        exchangeLinkText.textContent = domain;
        exchangeLink.classList.remove('disabled');
        exchangeLinkContainer.style.display = 'block';
      } else {
        exchangeLink.removeAttribute('href');
        exchangeLinkText.textContent = '(Select an exchange to view)';
        exchangeLink.classList.add('disabled');
        exchangeLinkContainer.style.display = 'block';
      }
      
      // Update withdrawal history URL
      if (selectedExchange && withdrawalHistoryUrls[selectedExchange]) {
        const withdrawalHistoryUrl = withdrawalHistoryUrls[selectedExchange];
        const domain = withdrawalHistoryUrl.replace('https://www.', '').replace('https://', '');
        withdrawHistoryLink.href = withdrawalHistoryUrl;
        withdrawHistoryLinkText.textContent = domain;
        withdrawHistoryLink.classList.remove('disabled');
        withdrawHistoryLinkContainer.style.display = 'block';
      } else {
        withdrawHistoryLink.removeAttribute('href');
        withdrawHistoryLinkText.textContent = '(Select an exchange to view)';
        withdrawHistoryLink.classList.add('disabled');
        withdrawHistoryLinkContainer.style.display = 'block';
      }
    }

    if (exchangeNameSelect) {
      exchangeNameSelect.addEventListener('change', updateExchangeLink);
    }

    // Build explorer URL from network and tx hash
    function getExplorerUrl(network, txHash) {
      const base = explorerUrls[network];
      if (!base || !txHash) return '';
      return base.replace('{tx}', txHash);
    }

    function populateWithdrawCoinOptions(network) {
      if (!withdrawCoinSelect) return;
      const placeholder = document.createElement('option');
      placeholder.value = '';
      placeholder.textContent = 'Select coin';

      // Clear existing options
      while (withdrawCoinSelect.firstChild) {
        withdrawCoinSelect.removeChild(withdrawCoinSelect.firstChild);
      }

      const coins = networkCoinOptions[network] || [];
      withdrawCoinSelect.appendChild(placeholder);

      coins.forEach((coin) => {
        const opt = document.createElement('option');
        opt.value = coin;
        opt.textContent = coin;
        withdrawCoinSelect.appendChild(opt);
      });

      withdrawCoinSelect.value = '';
    }

    function updateExplorerLinkFromForm() {
      if (!withdrawNetworkSelect || !withdrawalTxHashInput || !explorerLinkField || !explorerLinkEl || !explorerLinkTextEl) {
        return;
      }
      const network = withdrawNetworkSelect.value;
      const tx = (withdrawalTxHashInput.value || '').trim();
      const url = getExplorerUrl(network, tx);
      if (url) {
        explorerLinkEl.href = url;
        explorerLinkEl.target = '_blank';
        explorerLinkEl.rel = 'noopener noreferrer';
        explorerLinkEl.classList.remove('disabled');
        explorerLinkTextEl.textContent = url.replace(/^https?:\/\//, '');
      } else {
        explorerLinkEl.removeAttribute('href');
        explorerLinkEl.removeAttribute('target');
        explorerLinkEl.removeAttribute('rel');
        explorerLinkEl.classList.add('disabled');
        explorerLinkTextEl.textContent = '(Explorer link will appear after you fill Network and TxHash above)';
      }
    }

    // Set date input max to today and min to 30 days ago
    function setupDateInput() {
      const today = new Date();
      const thirtyDaysAgo = new Date();
      thirtyDaysAgo.setDate(today.getDate() - 30);

      const maxDate = today.toISOString().split('T')[0];
      const minDate = thirtyDaysAgo.toISOString().split('T')[0];

      transactionDateInput.setAttribute('max', maxDate);
      transactionDateInput.setAttribute('min', minDate);
    }

    function getValue(id) {
      const el = document.getElementById(id);
      return el ? el.value.trim() : '';
    }

    function getFileName(id) {
      const el = document.getElementById(id);
      if (!el || !el.files || el.files.length === 0) return '';
      return el.files[0].name;
    }

    function updateCustomFileDisplay(inputEl) {
      if (!inputEl) return;
      const wrapper = inputEl.closest('.file-input-wrapper');
      if (!wrapper) return;
      const nameEl = wrapper.querySelector('.file-input-name');
      if (!nameEl) return;
      const placeholder = nameEl.getAttribute('data-placeholder') || 'No image selected';
      
      if (inputEl.files && inputEl.files.length > 0) {
        const file = inputEl.files[0];
        nameEl.textContent = file.name;
        
        // Show image preview
        if (file.type.startsWith('image/')) {
          const reader = new FileReader();
          reader.onload = function(e) {
            const previewId = inputEl.id === 'exchangeScreenshot' ? 'exchangeScreenshotImg' : 'explorerScreenshotImg';
            const previewEl = document.getElementById(previewId);
            if (previewEl) {
              previewEl.src = e.target.result;
              wrapper.classList.add('has-image');
              
              // Add click handler to preview for modal view
              previewEl.onclick = function() {
                showImageModal(e.target.result);
              };
            }
          };
          reader.readAsDataURL(file);
        }
      } else {
        nameEl.textContent = placeholder;
        wrapper.classList.remove('has-image');
      }
      
      // Hide browser's default file input text
      inputEl.style.fontSize = '0';
    }

    function clearImagePreview(inputId) {
      const inputEl = document.getElementById(inputId);
      if (inputEl) {
        inputEl.value = '';
        const wrapper = inputEl.closest('.file-input-wrapper');
        if (wrapper) {
          wrapper.classList.remove('has-image');
          const nameEl = wrapper.querySelector('.file-input-name');
          if (nameEl) {
            const placeholder = nameEl.getAttribute('data-placeholder') || 'No image selected';
            nameEl.textContent = placeholder;
          }
          const previewId = inputId === 'exchangeScreenshot' ? 'exchangeScreenshotImg' : 'explorerScreenshotImg';
          const previewEl = document.getElementById(previewId);
          if (previewEl) {
            previewEl.src = '';
          }
        }
      }
      refreshButton();
    }

    function showImageModal(imageSrc) {
      let modal = document.getElementById('imagePreviewModal');
      if (!modal) {
        // Create modal if it doesn't exist
        modal = document.createElement('div');
        modal.id = 'imagePreviewModal';
        modal.className = 'image-preview-modal';
        modal.innerHTML = `
          <div class="image-preview-modal-close" onclick="closeImageModal()">Ã—</div>
          <img src="" alt="Full preview" />
        `;
        document.body.appendChild(modal);
      }
      const modalImg = modal.querySelector('img');
      modalImg.src = imageSrc;
      modal.classList.add('active');
    }

    function closeImageModal() {
      const modal = document.getElementById('imagePreviewModal');
      if (modal) {
        modal.classList.remove('active');
      }
    }

    // Close modal on background click
    document.addEventListener('click', function(e) {
      const modal = document.getElementById('imagePreviewModal');
      if (modal && e.target === modal) {
        closeImageModal();
      }
    });

    function validateRequired(showErrors = false) {
      let valid = true;

      requiredFields.forEach((fieldId) => {
        const el = document.getElementById(fieldId);
        if (!el) return;

        let value;
        if (fieldId === 'exchangeScreenshot' || fieldId === 'explorerScreenshot') {
          value = el.files && el.files.length > 0 ? 'has-file' : '';
        } else {
          value = getValue(fieldId);
        }

        const fieldWrapper = el.closest('.field-group') || el.closest('.field');
        if (!fieldWrapper) return;

        let errorEl = fieldWrapper.querySelector('.error-text');
        if (!errorEl) {
          errorEl = document.createElement('div');
          errorEl.className = 'error-text';
          fieldWrapper.appendChild(errorEl);
        }

        if (!value) {
          valid = false;
          if (showErrors) {
            fieldWrapper.classList.add('error');
            errorEl.textContent = 'This field is required.';
          }
        } else {
          fieldWrapper.classList.remove('error');
          errorEl.textContent = '';
        }
      });

      // Validate date is within last 30 days
      const dateValue = getValue('transactionDate');
      if (dateValue) {
        const selectedDate = new Date(dateValue);
        const today = new Date();
        const thirtyDaysAgo = new Date();
        thirtyDaysAgo.setDate(today.getDate() - 30);

        if (selectedDate < thirtyDaysAgo || selectedDate > today) {
          valid = false;
          const dateField = document.getElementById('transactionDate').closest('.field-group');
          if (dateField) {
            dateField.classList.add('error');
            const errorEl = dateField.querySelector('.error-text') || document.createElement('div');
            errorEl.className = 'error-text';
            errorEl.textContent = 'Date must be within the last 30 days.';
            if (!dateField.querySelector('.error-text')) {
              dateField.appendChild(errorEl);
            }
          }
        }
      }

      return valid;
    }

    function buildPayload() {
      const payload = {
        task_type: 'withdrawal',
        withdrawal: {
          exchange_name: getValue('exchangeName'),
          exchange_ui_screenshot_file: getFileName('exchangeScreenshot'),
          network: getValue('withdrawNetwork'),
          coin: getValue('withdrawCoin'),
          withdraw_amount: getValue('withdrawAmount'),
          network_fee: getValue('withdrawNetworkFee'),
          withdrawal_address: getValue('withdrawalAddress'),
          withdrawal_txhash: getValue('withdrawalTxHash'),
          transaction_date: getValue('transactionDate'),
          explorer_screenshot_file: getFileName('explorerScreenshot'),
          sender_address: getValue('senderAddress'),
          receiver_address: getValue('receiverAddress')
        },
        submitted_at: Date.now()
      };

      return payload;
    }

    function refreshButton() {
      const hasAllRequired = validateRequired(false);
      if (hasAllRequired) {
        submitBtn.classList.remove('disabled');
      } else {
        submitBtn.classList.add('disabled');
      }
    }

    // Setup date input constraints
    setupDateInput();

    function syncTransactionDatePlaceholder() {
      if (!transactionDateInput) return;
      const ph = document.getElementById('transactionDatePlaceholder');
      if (!ph) return;
      if (transactionDateInput.value) {
        ph.style.display = 'none';
        transactionDateInput.classList.remove('show-placeholder');
      } else {
        ph.style.display = 'block';
        transactionDateInput.classList.add('show-placeholder');
      }
    }

    // Make transaction date use picker on click (prevent manual typing)
    if (transactionDateInput) {
      transactionDateInput.addEventListener('click', () => {
        if (transactionDateInput.showPicker) {
          transactionDateInput.showPicker();
        }
      });

      transactionDateInput.addEventListener('keydown', (e) => {
        // Block manual typing, but allow Tab for accessibility
        if (e.key !== 'Tab') {
          e.preventDefault();
        }
      });

      transactionDateInput.addEventListener('change', syncTransactionDatePlaceholder);
      transactionDateInput.addEventListener('input', syncTransactionDatePlaceholder);
    }

    // Initial sync after listeners are set up
    syncTransactionDatePlaceholder();

    // Initial coin options (no network selected yet)
    populateWithdrawCoinOptions(withdrawNetworkSelect ? withdrawNetworkSelect.value : '');

    // Event listeners
    document.querySelectorAll('input, select').forEach((el) => {
      el.addEventListener('input', () => {
        const fieldWrapper = el.closest('.field-group') || el.closest('.field');
        if (fieldWrapper) {
          fieldWrapper.classList.remove('error');
          const errorEl = fieldWrapper.querySelector('.error-text');
          if (errorEl) {
            errorEl.textContent = '';
          }
        }
        refreshButton();

        // Update explorer link when relevant fields change
        if (el.id === 'withdrawNetwork' || el.id === 'withdrawalTxHash') {
          updateExplorerLinkFromForm();
        }

        // Update coin options when network changes
        if (el.id === 'withdrawNetwork') {
          populateWithdrawCoinOptions(el.value);
        }
      });

      el.addEventListener('change', () => {
        if (el.type === 'file') {
          updateCustomFileDisplay(el);
        }
        refreshButton();

        if (el.id === 'withdrawNetwork' || el.id === 'withdrawalTxHash') {
          updateExplorerLinkFromForm();
        }

        if (el.id === 'withdrawNetwork') {
          populateWithdrawCoinOptions(el.value);
        }
      });
    });

    // Prevent file input wrapper click from triggering file input when clicking preview
    document.querySelectorAll('.file-input-wrapper').forEach(wrapper => {
      wrapper.addEventListener('click', function(e) {
        if (e.target.closest('.image-preview-container')) {
          e.stopPropagation();
        }
      });
    });

    // Prevent file input wrapper click from triggering file input when clicking preview
    document.querySelectorAll('.file-input-wrapper').forEach(wrapper => {
      wrapper.addEventListener('click', function(e) {
        if (e.target.closest('.image-preview-container')) {
          e.stopPropagation();
        }
      });
    });

    // Initialize exchange link and withdrawal history URL on page load
    updateExchangeLink();

    submitBtn.addEventListener('click', () => {
      const isValid = validateRequired(true);
      if (!isValid) {
        const firstError = document.querySelector('.field-group.error, .field.error');
        if (firstError) {
          firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
        return;
      }

      const payload = buildPayload();
      console.log('CEX withdrawal task submission payload:', payload);
      alert('Withdrawal task submitted. Check console for payload JSON.');
    });
  </script>
</body>
</html>

